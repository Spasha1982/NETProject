name: Deploy ASP.NET Framework App

on:
  workflow_dispatch:  # allows manual trigger from GitHub UI

permissions:
  id-token: write        # ‚úÖ Required for OIDC login
  contents: read

jobs:
  deploy:
    runs-on: windows-latest

    steps:
    - name: Download build artifact
      uses: actions/download-artifact@v4
      with:
        name: drop                  # must match ArtifactName from build.yml
        path: D:\a\NETProject\NETProject\drop
        repository: Spasha1982/NETProject
        run-id: 18873092812         # üëà replace with your actual build run ID

    - name: Display contents
      run: |
        Write-Host "Downloaded artifact contents:"
        Get-ChildItem -Recurse "D:\a\NETProject\NETProject\drop"

      # Example: Deploy to Azure Web App
    - name: Login to Azure using OIDC
      uses: azure/login@v2
      with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

      # 6Ô∏è‚É£ Deploy to Azure Web App
    - name: Deploy to Azure Web App
      uses: azure/webapps-deploy@v3
      with:
          app-name: "SFinfotechwebapp01"              # üëà Your Web App name
          package:  ${{ github.workspace }}/drop

      # Optional: Deploy to IIS via WinRM or FTP
      # - name: Deploy to IIS (FTP)
      #   uses: SamKirkland/FTP-Deploy-Action@v4
      #   with:
      #     server: ${{ secrets.FTP_SERVER }}
      #     username: ${{ secrets.FTP_USER }}
      #     password: ${{ secrets.FTP_PASSWORD }}
      #     local-dir: ${{ github.workspace }}/drop
      #     server-dir: /site/wwwroot
